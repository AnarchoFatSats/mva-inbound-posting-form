<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Dashboard - Legal Lead Management</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Professional Dashboard Styles -->
    <link rel="stylesheet" href="agent-aurora.css">

    <!-- AppConfig -->
    <script src="/js/app-config.js?v=1748481232267"></script>
    <script>
    window.APP_CONFIG = {
      "userPoolId": "us-east-1_lhc964tLD",
      "clientId": "5t6mane4fnvineksoqb4ta0iu1",
      "apiEndpoint": "https://9qtb4my1ij.execute-api.us-east-1.amazonaws.com/prod",
      "apiUrl": "https://9qtb4my1ij.execute-api.us-east-1.amazonaws.com/prod",
      "apiKey": "",
      "buildTime": "2025-05-29T01:13:52.266Z",
      "buildEnv": "production"
    };
    window.preloadedConfig = window.APP_CONFIG;
    </script>

    <!-- Amazon Cognito SDK -->
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1001.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@6.3.7/dist/amazon-cognito-identity.min.js"></script>

    <!-- Initialize Cognito -->
    <script>
    // Wait for SDK to load
    function waitForCognitoSDK() {
        return new Promise((resolve, reject) => {
            if (typeof AmazonCognitoIdentity !== 'undefined') {
                resolve();
                return;
            }

            let attempts = 0;
            const maxAttempts = 10;
            const interval = setInterval(() => {
                attempts++;
                if (typeof AmazonCognitoIdentity !== 'undefined') {
                    clearInterval(interval);
                    resolve();
                } else if (attempts >= maxAttempts) {
                    clearInterval(interval);
                    reject(new Error('Cognito SDK failed to load'));
                }
            }, 500);
        });
    }

    // Initialize auth
    async function initializeAuth() {
        try {
            await waitForCognitoSDK();
            console.log('✅ Cognito SDK loaded successfully');
            return true;
        } catch (error) {
            console.error('❌ Failed to initialize Cognito:', error);
            return false;
        }
    }

    // Main initialization sequence
    window.addEventListener('load', async () => {
        try {
            const authInitialized = await initializeAuth();
            if (!authInitialized) {
                throw new Error('Auth initialization failed');
            }
        } catch (error) {
            console.error('Initialization error:', error);
            window.location.href = 'login.html';
        }
    });
    </script>
</head>
<body>
    <!-- Professional Background -->
    <div class="gradient-bg"></div>
    
    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" onclick="switchTab('live-dashboard')">
                <span class="tab-icon">📊</span>
                Live Dashboard
            </button>
            <button class="tab-button" onclick="switchTab('my-leads')">
                <span class="tab-icon">👤</span>
                My Leads
                <span class="badge" id="my-leads-count">0</span>
            </button>
        </div>

        <!-- Live Dashboard Tab -->
        <div class="tab-content active" id="live-dashboard">
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Available Leads</h3>
                    <div class="stat-value" id="available-count">0</div>
                    <div class="stat-trend positive">Live Updates Every 15s</div>
                </div>
                <div class="stat-card">
                    <h3>Active Leads</h3>
                    <div class="stat-value" id="active-count">0</div>
                    <div class="stat-trend">Total Active Cases</div>
                </div>
                <div class="stat-card">
                    <h3>Retained</h3>
                    <div class="stat-value" id="retained-count">0</div>
                    <div class="stat-trend">Successfully Retained</div>
                </div>
                <div class="stat-card">
                    <h3>Conversion Rate</h3>
                    <div class="stat-value" id="conversion-rate">0%</div>
                    <div class="stat-trend">Overall Success Rate</div>
                </div>
            </div>

            <!-- Available Leads Section -->
            <section class="glass-section">
                <div class="section-header">
                    <h2 class="section-title">New Available Leads</h2>
                    <div class="section-actions">
                        <input type="text" class="glass-input" id="search-leads" placeholder="Search leads...">
                        <button class="btn" onclick="refreshLeads()">
                            <span class="btn-icon">🔄</span> Refresh
                        </button>
                    </div>
                </div>
                <div class="leads-grid" id="available-leads-grid">
                    <!-- Lead cards will be inserted here -->
                </div>
            </section>
        </div>

        <!-- My Leads Tab -->
        <div class="tab-content" id="my-leads">
            <div class="my-leads-header">
                <h2>My Active Leads</h2>
                <div class="lead-filters">
                    <select class="glass-input" id="filter-status">
                        <option value="all">All Status</option>
                        <option value="new">New</option>
                        <option value="contacted">Contacted</option>
                        <option value="qualified">Qualified</option>
                        <option value="retained-for-firm">Retained for Firm</option>
                        <option value="docs-sent">Docs Sent</option>
                    </select>
                    <button class="btn btn-secondary" onclick="refreshMyLeads()">
                        <span class="btn-icon">🔄</span> Refresh
                    </button>
                </div>
            </div>
            <div class="leads-grid" id="my-leads-grid">
                <!-- My lead cards will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Lead Details Modal -->
    <div class="modal-overlay" id="lead-modal" style="display: none;">
        <div class="glass-modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Lead Details</h3>
                <button class="close-btn" onclick="closeLeadModal()">×</button>
            </div>
            <div class="modal-content" id="lead-details">
                <!-- Lead details will be inserted here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeLeadModal()">Close</button>
                <button class="btn" id="modal-action-btn" style="display: none;">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Professional Dashboard JS -->
    <script src="agent-aurora.js"></script>
</body>
</html> 